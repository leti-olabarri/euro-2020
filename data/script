-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;

CREATE TABLE IF NOT EXISTS public.country
(
    country_id serial NOT NULL,
    country "char" NOT NULL,
    coach "char" NOT NULL,
    PRIMARY KEY (country_id)
);

CREATE TABLE IF NOT EXISTS public.club
(
    club_id serial NOT NULL,
    club "char" NOT NULL,
    league "char" NOT NULL,
    PRIMARY KEY (club_id)
);

CREATE TABLE IF NOT EXISTS public."position"
(
    position_id "char" NOT NULL,
    "position" "char" NOT NULL,
    PRIMARY KEY (position_id)
);

CREATE TABLE IF NOT EXISTS public.player
(
    player_id serial NOT NULL,
    player_name "char" NOT NULL,
    age integer NOT NULL,
    country_id integer NOT NULL,
    squad_number integer NOT NULL,
    position_id "char" NOT NULL,
    club_id integer NOT NULL,
    PRIMARY KEY (player_id),
	FOREIGN KEY (country_id) REFERENCES country(country_id) ON DELETE CASCADE,
	FOREIGN KEY (club_id) REFERENCES club(club_id) ON DELETE CASCADE,
	FOREIGN KEY (position_id) REFERENCES "position"(position_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS public.match
(
    match_id serial NOT NULL,
    stage "char" NOT NULL,
    penaltis boolean NOT NULL,
    pens_home_score integer,
    pens_away_score integer,
    team_name_home "char" NOT NULL,
    team_name_away "char" NOT NULL,
    team_home_score integer NOT NULL,
    team_away_score integer NOT NULL,
    poss_home_perc integer NOT NULL,
    poss_away_perc integer NOT NULL,
    total_shots_home integer NOT NULL,
    total_shots_away integer NOT NULL,
    shots_on_target_home integer NOT NULL,
    shots_on_target_away integer NOT NULL,
    PRIMARY KEY (match_id)
);

CREATE TABLE IF NOT EXISTS public.card
(
    card_id serial NOT NULL,
    player_id integer NOT NULL,
    match_id integer NOT NULL,
    color "char" NOT NULL,
    PRIMARY KEY (card_id),
	FOREIGN KEY (player_id) REFERENCES player(player_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS public.goal
(
    goal_id serial NOT NULL,
    player_id integer NOT NULL,
    match_id "char" NOT NULL,
    goal_minute integer,
    PRIMARY KEY (goal_id),
	FOREIGN KEY (player_id) REFERENCES player(player_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS public.stats
(
    player_id integer NOT NULL,
    minutes smallint,
    fouls_committed smallint,
    fouls_suffered smallint,
    passing_acc_perc smallint,
    attempts smallint,
    on_target smallint,
    assists smallint,
    top_speed numeric,
	saves smallint,
	goals_conceded smallint,
	claims smallint,
	punches smallint,
	clean_sheets smallint,
    PRIMARY KEY (player_id),
	CONSTRAINT fk_player_id FOREIGN KEY (player_id) REFERENCES player (player_id),
	UNIQUE (player_id)
);

CREATE TABLE player_match (
  player_id int NOT NULL,
  match_id int NOT NULL,
  PRIMARY KEY (player_id, match_id),
  FOREIGN KEY (player_id) REFERENCES player(player_id) ON UPDATE CASCADE,
  FOREIGN KEY (match_id) REFERENCES "match"(match_id) ON UPDATE CASCADE
);

CREATE TABLE country_match (
  country_id int NOT NULL,
  match_id int NOT NULL,
  PRIMARY KEY (country_id, match_id),
  FOREIGN KEY (country_id) REFERENCES country(country_id) ON UPDATE CASCADE,
  FOREIGN KEY (match_id) REFERENCES "match"(match_id) ON UPDATE CASCADE
);

END;